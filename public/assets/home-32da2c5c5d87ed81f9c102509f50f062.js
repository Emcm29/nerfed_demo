function updateCountry(){for(var t=select_dialect.options.length-1;t>=0;t--)select_dialect.remove(t);for(var e=langs[select_language.selectedIndex],t=1;e.length>t;t++)select_dialect.options.add(new Option(e[t][1],e[t][0]));select_dialect.style.visibility=1==e[1].length?"hidden":"visible"}function upgrade(){start_button.style.visibility="hidden",showInfo("info_upgrade")}function linebreak(t){return t.replace(two_line,"<p></p>").replace(one_line,"<br>")}function capitalize(t){return t.replace(first_char,function(t){return t.toUpperCase()})}function createEmail(){var t=final_transcript.indexOf("\n");(0>t||t>=80)&&(t=40+final_transcript.substring(40).indexOf(" "));var e=encodeURI(final_transcript.substring(0,t)),n=encodeURI(final_transcript.substring(t+1));window.location.href="mailto:?subject="+e+"&body="+n}function copyButton(){recognizing&&(recognizing=!1,recognition.stop()),copy_button.style.display="none",copy_info.style.display="inline-block",showInfo("")}function emailButton(){recognizing?(create_email=!0,recognizing=!1,recognition.stop()):createEmail(),email_button.style.display="none",email_info.style.display="inline-block",showInfo("")}function startButton(t){return recognizing?(recognition.stop(),void 0):($.post("/ctranslates",{derp:"derp"}),derp_transcript="",final_transcript="",recognition.lang=select_dialect.value,recognition.start(),ignore_onend=!1,final_span.innerHTML="",interim_span.innerHTML="",start_img.src="/intl/en/chrome/assets/common/images/content/mic-slash.gif",showInfo("info_allow"),showButtons("none"),start_timestamp=t.timeStamp,void 0)}function showInfo(t){if(t){for(var e=info.firstChild;e;e=e.nextSibling)e.style&&(e.style.display=e.id==t?"inline":"none");info.style.visibility="visible"}else info.style.visibility="hidden"}function showButtons(t){t!=current_style&&(current_style=t,copy_button.style.display=t,email_button.style.display=t,copy_info.style.display="none",email_info.style.display="none")}for(var langs=[["Afrikaans",["af-ZA"]],["Bahasa Indonesia",["id-ID"]],["Bahasa Melayu",["ms-MY"]],["Català",["ca-ES"]],["Čeština",["cs-CZ"]],["Deutsch",["de-DE"]],["English",["en-AU","Australia"],["en-CA","Canada"],["en-IN","India"],["en-NZ","New Zealand"],["en-ZA","South Africa"],["en-GB","United Kingdom"],["en-US","United States"]],["Español",["es-AR","Argentina"],["es-BO","Bolivia"],["es-CL","Chile"],["es-CO","Colombia"],["es-CR","Costa Rica"],["es-EC","Ecuador"],["es-SV","El Salvador"],["es-ES","España"],["es-US","Estados Unidos"],["es-GT","Guatemala"],["es-HN","Honduras"],["es-MX","México"],["es-NI","Nicaragua"],["es-PA","Panamá"],["es-PY","Paraguay"],["es-PE","Perú"],["es-PR","Puerto Rico"],["es-DO","República Dominicana"],["es-UY","Uruguay"],["es-VE","Venezuela"]],["Euskara",["eu-ES"]],["Français",["fr-FR"]],["Galego",["gl-ES"]],["Hrvatski",["hr_HR"]],["IsiZulu",["zu-ZA"]],["Íslenska",["is-IS"]],["Italiano",["it-IT","Italia"],["it-CH","Svizzera"]],["Magyar",["hu-HU"]],["Nederlands",["nl-NL"]],["Norsk bokmål",["nb-NO"]],["Polski",["pl-PL"]],["Português",["pt-BR","Brasil"],["pt-PT","Portugal"]],["Română",["ro-RO"]],["Slovenčina",["sk-SK"]],["Suomi",["fi-FI"]],["Svenska",["sv-SE"]],["Türkçe",["tr-TR"]],["български",["bg-BG"]],["Pусский",["ru-RU"]],["Српски",["sr-RS"]],["한국어",["ko-KR"]],["中文",["cmn-Hans-CN","普通话 (中国大陆)"],["cmn-Hans-HK","普通话 (香港)"],["cmn-Hant-TW","中文 (台灣)"],["yue-Hant-HK","粵語 (香港)"]],["日本語",["ja-JP"]],["Lingua latīna",["la"]]],i=0;langs.length>i;i++)select_language.options[i]=new Option(langs[i][0],i);select_language.selectedIndex=6,updateCountry(),select_dialect.selectedIndex=6,showInfo("info_start");var create_email=!1,final_transcript="",recognizing=!1,ignore_onend,start_timestamp;if("webkitSpeechRecognition"in window){start_button.style.display="inline-block";var recognition=new webkitSpeechRecognition;recognition.continuous=!0,recognition.interimResults=!0,recognition.onstart=function(){recognizing=!0,showInfo("info_speak_now"),start_img.src="/intl/en/chrome/assets/common/images/content/mic-animate.gif"},recognition.onerror=function(t){"no-speech"==t.error&&(start_img.src="/intl/en/chrome/assets/common/images/content/mic.gif",showInfo("info_no_speech"),ignore_onend=!0),"audio-capture"==t.error&&(start_img.src="/intl/en/chrome/assets/common/images/content/mic.gif",showInfo("info_no_microphone"),ignore_onend=!0),"not-allowed"==t.error&&(100>t.timeStamp-start_timestamp?showInfo("info_blocked"):showInfo("info_denied"),ignore_onend=!0)},recognition.onend=function(){if(recognizing=!1,!ignore_onend){if(start_img.src="/intl/en/chrome/assets/common/images/content/mic.gif",!final_transcript)return showInfo("info_start"),void 0;if(showInfo(""),window.getSelection){window.getSelection().removeAllRanges();var t=document.createRange();t.selectNode(document.getElementById("final_span")),window.getSelection().addRange(t)}create_email&&(create_email=!1,createEmail())}};var num=0;recognition.onresult=function(t){var e="";if("undefined"==typeof t.results)return recognition.onend=null,recognition.stop(),upgrade(),void 0;for(var n=t.resultIndex;t.results.length>n;++n)t.results[n].isFinal?(final_transcript+=t.results[n][0].transcript,derp_transcript=t.results[n][0].transcript,num+=1,$.post("/ctranslates/update",{text:derp_transcript,count:num}),$("#transbox").load("ctranslates/new")):e+=t.results[n][0].transcript;final_transcript=capitalize(final_transcript),final_span.innerHTML=linebreak(final_transcript),interim_span.innerHTML=linebreak(e),(final_transcript||e)&&showButtons("inline-block")}}else upgrade();var two_line=/\n\n/g,one_line=/\n/g,first_char=/\S/,current_style;